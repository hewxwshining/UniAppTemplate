{"version":3,"file":"auth.js","sources":["api/auth.ts"],"sourcesContent":["import cache from '@/utils/cache';\r\nimport { getBaseUrl, http } from '@/utils/request';\r\n\r\n// 定义参数接口\r\ninterface everyParams {\r\n  [key: string]: any; // 允许任意属性\r\n}\r\n\r\n\r\n/**\r\n * 定义响应数据接口(用于一些传入一些方法中，但每个字段不是必须的)\r\n */\r\nexport interface ResData<T = any> {\r\n\tcode?: number;\r\n\tdata?: T;\r\n\tmsg?: string;\r\n}\r\n\r\nexport interface loginType {\r\n  UserName: string;\r\n  PassWord: string;\r\n  WxAppId:string;\r\n  WxOpenid:string;\r\n}\r\n\r\n// 登录响应数据类型定义\r\nexport interface LoginResponseData {\r\n  access_token: string;\r\n  expires_in: number;\r\n  token_type: string;\r\n  refresh_token: string;\r\n  scope: string;\r\n}\r\n\r\n// 用户信息类型定义\r\nexport interface UserInfo {\r\n  UserId: string;\r\n  UserType: string;\r\n  UserName: string;\r\n  PerId: string;\r\n  PerCn: string;\r\n  PerName: string;\r\n  PerPhotoPath: string;\r\n  OrgId: string;\r\n  BaseId: string;\r\n  FirmInfoId?: string;\r\n  FirmName?: string;\r\n  Cars?: any[];\r\n  [key: string]: any;\r\n}\r\n\r\n// 用户信息API响应类型\r\nexport interface UserInfoResponse {\r\n  User: UserInfo;\r\n  [key: string]: any;\r\n}\r\n\r\nconst awaitWrap = async <T>(promise: Promise<T>): Promise<[any, T | null]> => {\r\n  try {\r\n    const data = await promise;\r\n    return [null, data];\r\n  } catch (err) {\r\n    return [err, null];\r\n  }\r\n};\r\n\r\nexport const getCaptchaApi = (data?: everyParams) => {\r\n  let url = '/api/timeout/640';\r\n  return awaitWrap(http.get(url, data, { loading: true }));\r\n};\r\n\r\nexport const loginApi = (data: loginType) => {\r\n  let url = '/WxCarApp/WxOpenLogin';\r\n  return awaitWrap(http.post(url, data, { loading: true }));\r\n};\r\n\r\nexport const userInfoApi = () => {\r\n  let url = '/WxCarApp/GetUser';\r\n  return awaitWrap(http.post(url));\r\n};\r\n\r\n/**\r\n * 微信免登录\r\n */\r\nexport const wxLoginFreeApi = (data: everyParams) => {\r\n  let url = '/WxCarApp/WxOpenUser';\r\n  return awaitWrap(http.post(url, data));\r\n};\r\n\r\n/**\r\n * 获取微信openid\r\n */\r\nexport const getWxOpenId = (data: everyParams) => {\r\n  let url = '/WxCarApp/GetWxOpenId';\r\n  return awaitWrap(http.post(url, data));\r\n};\r\n\r\n/**\r\n * 获取字典配置\r\n * @param data 格式{Flag:DictFlagEnum.CarRepairType}\r\n */\r\nexport const getDictDocApi = (data ?: everyParams) => {\r\n\tlet url = \"/WxCarApp/GetDictDoc\";\r\n\treturn http.post(url, data);\r\n}\r\n\r\n\r\n/*\r\n*上传逻辑（带进度提示）\r\n*/\r\nexport const uploadMyFile = async (file : any) => {\r\n\tconsole.log(file)\r\n\tuni.showLoading({ title: '上传中...', mask: true });\r\n\ttry {\r\n\t\tconst res = await uni.uploadFile({\r\n\t\t\turl: getBaseUrl() + \"/WxCarApp/UploadImage\",\r\n\t\t\tfilePath: file,\r\n\t\t\tname: 'file',\r\n\t\t\tformData: {\r\n\t\t\t\tfolderName: 'WxCar'\r\n\t\t\t},\r\n\t\t\theader: { 'Authorization': `Bearer ${cache.getAccessToken()}` },\r\n\t\t\tonProgressUpdate: (e : any) => {\r\n\t\t\t\tconsole.log(e)\r\n\t\t\t\tconsole.log(`进度：${e.progress}%`);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tif (res.statusCode !== 200) throw new Error('上传失败');\r\n\t\tconst data = JSON.parse(res.data);\r\n\t\treturn data;\r\n\t} finally {\r\n\t\tuni.hideLoading();\r\n\t}\r\n};\r\n\r\n/**\r\n * 删除临时区的文件\r\n */\r\nexport const delTmpFile = (data ?: everyParams) => {\r\n\tlet url = \"/WxCarApp/DeleteUpFile\";\r\n\treturn http.post(url, data);\r\n}\r\n\r\n/**\r\n * 解绑微信和账号 {WxAppId:'',WxOpenid:''}\r\n */\r\nexport const wxUserUnbind = (data ?: everyParams) => {\r\n\tlet url = \"/WxCarApp/WxUserUnbind\";\r\n\treturn http.post(url, data);\r\n}\r\n\r\n"],"names":["http"],"mappings":";;;AAyDA,MAAM,YAAY,OAAU,YAAkD;AACxE,MAAA;AACF,UAAM,OAAO,MAAM;AACZ,WAAA,CAAC,MAAM,IAAI;AAAA,WACX,KAAK;AACL,WAAA,CAAC,KAAK,IAAI;AAAA,EACnB;AACF;AAOa,MAAA,WAAW,CAAC,SAAoB;AAC3C,MAAI,MAAM;AACH,SAAA,UAAUA,mBAAK,KAAK,KAAK,MAAM,EAAE,SAAS,KAAM,CAAA,CAAC;AAC1D;AAEO,MAAM,cAAc,MAAM;AAC/B,MAAI,MAAM;AACV,SAAO,UAAUA,cAAA,KAAK,KAAK,GAAG,CAAC;AACjC;AAKa,MAAA,iBAAiB,CAAC,SAAsB;AACnD,MAAI,MAAM;AACV,SAAO,UAAUA,cAAAA,KAAK,KAAK,KAAK,IAAI,CAAC;AACvC;AAKa,MAAA,cAAc,CAAC,SAAsB;AAChD,MAAI,MAAM;AACV,SAAO,UAAUA,cAAAA,KAAK,KAAK,KAAK,IAAI,CAAC;AACvC;;;;;"}