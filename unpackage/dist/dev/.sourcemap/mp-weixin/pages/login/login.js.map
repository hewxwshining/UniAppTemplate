{"version":3,"file":"login.js","sources":["pages/login/login.vue","E:/ProgramFilesForTools/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbG9naW4vbG9naW4udnVl"],"sourcesContent":["<template>\r\n\t<Layout title=\"登录\" :show-nav-bar=\"false\" :show-tab-bar=\"false\">\r\n\t\t<view class=\"login-content\">\r\n\t\t\t<!-- 登录标题 -->\r\n\t\t\t<view class=\"login-title dflex-c\">\r\n\t\t\t\t<image src=\"/static/images/login/car.png\" mode=\"aspectFit\" style=\"width: 55px; height: 55px\"></image>\r\n\t\t\t\t<text class=\"title-text\">车联网</text>\r\n\t\t\t</view>\r\n\r\n\t\t\t<!-- 登录表单 -->\r\n\t\t\t<view class=\"login-form\">\r\n\t\t\t\t<view class=\"login-form-content\">\r\n\t\t\t\t\t<view class=\"form-item\">\r\n\t\t\t\t\t\t<view class=\"input-label\">\r\n\t\t\t\t\t\t\t账号\r\n\t\t\t\t\t\t\t<text class=\"label-icon\">*</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"input-wrapper dflex\">\r\n\t\t\t\t\t\t\t<input v-model=\"username\" placeholder=\"请输入您的账号\" class=\"input-field\" autocomplete=\"off\"\r\n\t\t\t\t\t\t\t\t:data-form-type=\"'other'\" :data-lpignore=\"'true'\" :data-1p-ignore=\"'true'\"\r\n\t\t\t\t\t\t\t\t:data-bwignore=\"'true'\" :data-dashlane-ignore=\"'true'\"\r\n\t\t\t\t\t\t\t\t:data-bitwarden-watching=\"'false'\" />\r\n\t\t\t\t\t\t\t<uni-icons v-if=\"showClearIcon\" type=\"closeempty\" color=\"#808C99\" size=\"48rpx\"\r\n\t\t\t\t\t\t\t\t@click=\"clearIcon\"></uni-icons>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\r\n\t\t\t\t\t<view class=\"form-item\">\r\n\t\t\t\t\t\t<view class=\"input-label\">\r\n\t\t\t\t\t\t\t密码\r\n\t\t\t\t\t\t\t<text class=\"label-icon\">*</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"input-wrapper dflex\">\r\n\t\t\t\t\t\t\t<input :password=\"showPassword\" v-model=\"password\" class=\"input-field\" placeholder=\"请输入密码\"\r\n\t\t\t\t\t\t\t\tautocomplete=\"off\" :data-form-type=\"'other'\" :data-lpignore=\"'true'\"\r\n\t\t\t\t\t\t\t\t:data-1p-ignore=\"'true'\" :data-bwignore=\"'true'\" :data-dashlane-ignore=\"'true'\"\r\n\t\t\t\t\t\t\t\t:data-bitwarden-watching=\"'false'\" />\r\n\t\t\t\t\t\t\t<image\r\n\t\t\t\t\t\t\t\t:src=\"!showPassword ? '/static/images/login/psw-open.png' : '/static/images/login/psw.png'\"\r\n\t\t\t\t\t\t\t\tmode=\"aspectFill\" style=\"width: 48rpx; height: 48rpx\" @click=\"changePassword\"></image>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\r\n\t\t\t\t<!-- 登录按钮 -->\r\n\t\t\t\t<button class=\"login-btn\" :class=\"{ disabled: !canLogin }\" :disabled=\"!canLogin\"\r\n\t\t\t\t\t@click=\"handleLogin\">登录</button>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</Layout>\r\n</template>\r\n\r\n<script lang=\"ts\" setup>\r\n\timport { LoginResponseData } from '@/api/auth';\r\n\timport { APPID, CACHEKEY_OPENID, USERTYPE_DRIVER, USERTYPE_VENDOR } from '@/api/const';\r\n\timport Layout from '@/components/Layout/Layout.vue';\r\n\timport { useUserStore } from '@/store/modules/user';\r\n\r\n\timport { msg } from '@/utils/base';\r\n\timport cache, { setAccessToken } from '@/utils/cache';\r\n\timport { onLoad } from '@dcloudio/uni-app';\r\n\timport { computed, ref } from 'vue';\r\n\tconst userStore = useUserStore();\r\n\tconst username = ref<string>('');\r\n\tconst password = ref<string>('');\r\n\tconst showPassword = ref<Boolean>(true);\r\n\r\n\tconst changePassword = () => {\r\n\t\tshowPassword.value = !showPassword.value;\r\n\t};\r\n\tconst showClearIcon = computed(() => {\r\n\t\treturn !!username.value.length;\r\n\t});\r\n\tconst clearIcon = function () {\r\n\t\tusername.value = '';\r\n\t};\r\n\r\n\tconst canLogin = computed(() => {\r\n\t\treturn username.value && password.value;\r\n\t});\r\n\tconst isLoading = ref(false);\r\n\tconst handleLogin = async () => {\r\n\t\tif (!canLogin.value) return;\r\n\t\tif (isLoading.value) return;\r\n\t\tisLoading.value = true;\r\n\t\tlet wxAppId = '', wxOpenid = ''\r\n\r\n\t\twxAppId = APPID\r\n\t\twxOpenid = cache.get(CACHEKEY_OPENID,'')\r\n\r\n\t\tconst isSuccess = await userStore.loginWithPassword(username.value, password.value, wxAppId, wxOpenid);\r\n\t\tisLoading.value = false;\r\n\t\tif (isSuccess) {\r\n\t\t\tloginOk();\r\n\t\t}\r\n\t};\r\n\r\n\t/**\r\n\t * 存储登录token\r\n\t */\r\n\tconst setLoginToken = (res : LoginResponseData) => {\r\n\t\tconst { access_token, refresh_token, expires_in, token_type } = res;\r\n\t\tsetAccessToken(access_token);\r\n\t};\r\n\r\n\t/**\r\n\t * 登录跳转\r\n\t */\r\n\tconst loginOk = async () => {\r\n\t\tmsg('登录成功', { icon: 'success' });\r\n\t\tawait userStore.setUserInfos();\r\n\r\n\t\tif (userStore.userInfo.UserType == USERTYPE_DRIVER) {\r\n\t\t\t// 登录成功后跳转到首页\r\n\t\t\tuni.reLaunch({\r\n\t\t\t\turl: '/pages/driverSide/index/index'\r\n\t\t\t});\r\n\t\t}\r\n\t\tif (userStore.userInfo.UserType == USERTYPE_VENDOR) {\r\n\t\t\t// 登录成功后跳转到首页\r\n\t\t\tuni.reLaunch({\r\n\t\t\t\turl: '/pages/vendorSide/index/index'\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\tonLoad(() => {\r\n\r\n\t});\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n\t.login-container {\r\n\t\tmin-height: 100vh;\r\n\t\tbackground-color: #f5f5f5;\r\n\t}\r\n\r\n\t.login-content {\r\n\t\tpadding: 30rpx 20rpx;\r\n\t\tmargin-top: 100rpx;\r\n\t\t/* 为固定导航栏留出空间 */\r\n\t}\r\n\r\n\t.login-title {\r\n\t\ttext-align: center;\r\n\t\tmargin-bottom: 60rpx;\r\n\r\n\t\t.title-text {\r\n\t\t\tfont-size: 48rpx;\r\n\t\t\tfont-weight: 600;\r\n\t\t\tcolor: #fff;\r\n\t\t\tmargin-left: 10px;\r\n\t\t}\r\n\t}\r\n\r\n\t.login-form {\r\n\t\t.login-form-content {\r\n\t\t\tbackground-color: #d2e5f6;\r\n\t\t\tborder-radius: 8px;\r\n\t\t}\r\n\r\n\t\t.form-item {\r\n\t\t\tdisplay: flex;\r\n\t\t\talign-items: center;\r\n\t\t\tpadding: 32rpx;\r\n\r\n\t\t\t.input-label {\r\n\t\t\t\tfont-size: 32rpx;\r\n\t\t\t\tcolor: #000;\r\n\t\t\t\twidth: 162rpx;\r\n\r\n\t\t\t\t.label-icon {\r\n\t\t\t\t\tcolor: #f00;\r\n\t\t\t\t\tmargin-left: 10rpx;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t.input-wrapper {\r\n\t\t\t\tflex: 1;\r\n\t\t\t\t// background-color: #ffffff;\r\n\t\t\t\tborder-radius: 12rpx;\r\n\t\t\t\tpadding: 0 24rpx;\r\n\r\n\t\t\t\t.input-field {\r\n\t\t\t\t\theight: 88rpx;\r\n\t\t\t\t\tfont-size: 32rpx;\r\n\t\t\t\t\tcolor: #333333;\r\n\t\t\t\t\twidth: 100%;\r\n\r\n\t\t\t\t\t&::placeholder {\r\n\t\t\t\t\t\tcolor: #999999;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t.uni-input-input {\r\n\t\t\t\t\t\tfont-size: 32rpx !important;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t.login-btn {\r\n\t\t\twidth: 100%;\r\n\t\t\theight: 96rpx;\r\n\t\t\tline-height: 96rpx;\r\n\t\t\tbackground-color: #295af5;\r\n\t\t\tcolor: #ffffff;\r\n\t\t\tborder: none;\r\n\t\t\tborder-radius: 68rpx;\r\n\t\t\tfont-size: 32rpx;\r\n\t\t\tfont-weight: 600;\r\n\t\t\tmargin-top: 60rpx;\r\n\r\n\t\t\t&.disabled {\r\n\t\t\t\tbackground-color: #5d98fb;\r\n\t\t\t\tcolor: #fff !important;\r\n\t\t\t}\r\n\r\n\t\t\t&::after {\r\n\t\t\t\tborder: none;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</style>","import MiniProgramPage from 'F:/uniAppTemplate/pages/login/login.vue'\nwx.createPage(MiniProgramPage)"],"names":["useUserStore","ref","computed","APPID","cache","CACHEKEY_OPENID","msg","USERTYPE_DRIVER","uni","USERTYPE_VENDOR","onLoad"],"mappings":";;;;;;;;;;;;;;;AAuDC,MAAA,SAAmB,MAAA;;;;AAOnB,UAAM,YAAYA,mBAAAA;AACZ,UAAA,WAAWC,kBAAY,EAAE;AACzB,UAAA,WAAWA,kBAAY,EAAE;AACzB,UAAA,eAAeA,kBAAa,IAAI;AAEtC,UAAM,iBAAiB,MAAM;AACf,mBAAA,QAAQ,CAAC,aAAa;AAAA,IAAA;AAE9B,UAAA,gBAAgBC,cAAAA,SAAS,MAAM;AAC7B,aAAA,CAAC,CAAC,SAAS,MAAM;AAAA,IAAA,CACxB;AACD,UAAM,YAAY,WAAY;AAC7B,eAAS,QAAQ;AAAA,IAAA;AAGZ,UAAA,WAAWA,cAAAA,SAAS,MAAM;AACxB,aAAA,SAAS,SAAS,SAAS;AAAA,IAAA,CAClC;AACK,UAAA,YAAYD,kBAAI,KAAK;AAC3B,UAAM,cAAc,YAAY;AAC/B,UAAI,CAAC,SAAS;AAAO;AACrB,UAAI,UAAU;AAAO;AACrB,gBAAU,QAAQ;AACd,UAAA,UAAU,IAAI,WAAW;AAEnB,gBAAAE,UAAAA;AACC,iBAAAC,YAAAA,MAAM,IAAIC,UAAA,iBAAgB,EAAE;AAEjC,YAAA,YAAY,MAAM,UAAU,kBAAkB,SAAS,OAAO,SAAS,OAAO,SAAS,QAAQ;AACrG,gBAAU,QAAQ;AAClB,UAAI,WAAW;AACN;MACT;AAAA,IAAA;AAcD,UAAM,UAAU,YAAY;AAC3BC,iBAAAA,IAAI,QAAQ,EAAE,MAAM,UAAW,CAAA;AAC/B,YAAM,UAAU;AAEZ,UAAA,UAAU,SAAS,YAAYC,2BAAiB;AAEnDC,sBAAAA,MAAI,SAAS;AAAA,UACZ,KAAK;AAAA,QAAA,CACL;AAAA,MACF;AACI,UAAA,UAAU,SAAS,YAAYC,2BAAiB;AAEnDD,sBAAAA,MAAI,SAAS;AAAA,UACZ,KAAK;AAAA,QAAA,CACL;AAAA,MACF;AAAA,IAAA;AAGDE,kBAAAA,OAAO,MAAM;AAAA,IAAA,CAEZ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC/HF,GAAG,WAAW,eAAe;"}